# Tenancy Core runtime baseline (pre-MVP implementation)
# ADR-005: tenant isolation via dedicated schema and tenant-aware model
# ADR-006: platform-shared remains technical only

quarkus:
  application:
    name: tenancy-core
  http:
    host: 0.0.0.0
    port: ${TENANCY_CORE_HTTP_PORT:8071}
  datasource:
    db-kind: postgresql
    username: ${POSTGRES_TENANCY_USER:svc_tenancy_core}
    password: ${POSTGRES_TENANCY_PASSWORD:dev_password}
    jdbc:
      url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DATABASE:chiroerp}?currentSchema=${POSTGRES_TENANCY_SCHEMA:tenancy_core}
      max-size: ${DB_POOL_MAX_SIZE:20}
      min-size: ${DB_POOL_MIN_IDLE:5}
  hibernate-orm:
    database:
      generation: none
    log:
      sql: false
  flyway:
    migrate-at-start: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: ${POSTGRES_TENANCY_SCHEMA:tenancy_core}
    table: flyway_history_tenancy_core
  micrometer:
    export:
      prometheus:
        enabled: true
  log:
    level: ${LOG_LEVEL:INFO}
    console:
      json: true
  smallrye-health:
    root-path: /q/health
  smallrye-openapi:
    path: /q/openapi
    store-schema-directory: build/openapi
    store-schema-file-name: openapi
  swagger-ui:
    path: /q/swagger-ui
    always-include: true

mp:
  openapi:
    extensions:
      smallrye:
        info:
          title: ChiroERP Tenancy API
          version: 1.0.0
          description: Multi-tenant provisioning and lifecycle management API
          contact:
            name: ChiroERP API Team
            email: api@chiroerp.example.com
            url: https://github.com/olwalgeorge/chiroerp-final
          license:
            name: Proprietary
        operationIdStrategy: METHOD

kafka:
  bootstrap:
    servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:19092}

chiroerp:
  tenancy:
    # ADR-005: AUTO mode enables tier-based isolation (STANDARD→DISCRIMINATOR, PREMIUM→SCHEMA, ENTERPRISE→DATABASE)
    # Override with TENANT_ISOLATION_STRATEGY env var to force a specific mode (DISCRIMINATOR, SCHEMA, DATABASE)
    isolation-strategy: ${TENANT_ISOLATION_STRATEGY:AUTO}
    default-tenant-id: ${DEFAULT_TENANT_ID:default}
    provisioning:
      schema-grant-role: ${TENANCY_SCHEMA_GRANT_ROLE:}
      database:
        admin-url: ${TENANCY_DB_ADMIN_JDBC_URL:jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/postgres}
        admin-username: ${TENANCY_DB_ADMIN_USERNAME:${POSTGRES_TENANCY_USER:svc_tenancy_core}}
        admin-password: ${TENANCY_DB_ADMIN_PASSWORD:${POSTGRES_TENANCY_PASSWORD:dev_password}}
        owner-role: ${TENANCY_DB_OWNER_ROLE:${POSTGRES_TENANCY_USER:svc_tenancy_core}}
        template: ${TENANCY_DB_TEMPLATE:""}
      metrics:
        enabled: ${TENANCY_PROVISIONING_METRICS_ENABLED:true}
  messaging:
    tenant-events:
      topic: ${TENANCY_EVENTS_TOPIC:chiroerp.tenancy.events}
      outbox:
        enabled: ${TENANCY_OUTBOX_ENABLED:true}
        batch-size: ${TENANCY_OUTBOX_BATCH_SIZE:100}
        poll-interval: ${TENANCY_OUTBOX_POLL_INTERVAL:5s}
        max-backoff-seconds: ${TENANCY_OUTBOX_MAX_BACKOFF_SECONDS:60}
        max-attempts: ${TENANCY_OUTBOX_MAX_ATTEMPTS:10}
        metrics-refresh-interval: ${TENANCY_OUTBOX_METRICS_REFRESH_INTERVAL:30s}
        pending-threshold: ${TENANCY_OUTBOX_PENDING_THRESHOLD:500}
        dead-threshold: ${TENANCY_OUTBOX_DEAD_THRESHOLD:0}
